
<p>Following my previous post I want to use tar instead of cpio. As
before I wanted to skip big temporary directories. I spent a day
trying to combine find and tar and couldn't get it to work.</p>

<pre class="example">
system='^/\(\(\(dev\|proc\|var/run\|var/lock\|sys\|media\)\
\|\(home/ubuntu/\(tmp\|dyn\|stat\|backup|\.incoming|\.gnome\)\
\)\).*\|\(home\|home/ubuntu\)$\)'

# tail to skip the parent directory
find / -type d -a -not -regex &quot;${system}&quot; | \
     tail -n +2 | xargs tar czvf /media/portable/backup/tao/home.tar.gz
</pre>

<p>The problem with the code above is that the regular expression is
unreadable.</p>

<p>I then remembered that zsh has tilde pattern when enabling extended
glob. It matches all files before tilde except the one after. This
leads to the following code:</p>

<pre class="example">
#!/bin/zsh

setopt extended_glob

echo /*~(dev|proc|var/run|var/lock|sys|media|home) \
     ${HOME}/*~${HOME}/(tmp|dyn|stat|backup) \
     ${HOME}/.*~${HOME}/(.incoming|.gnome) | \
xargs tar czvf /media/portable/system.tar.gz
</pre>

<p>Note how much easier it is to read.</p>

