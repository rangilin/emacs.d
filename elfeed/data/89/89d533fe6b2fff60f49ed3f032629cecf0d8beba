<p>I'm an avid xmonad user, and I've recently switched over to conky +
dzen as my status bar. A recent issue I had is with getting Dropbox
status information into my conky.</p>
<p>I did some hacking and here's the result. I love the way it turned out:</p>
<img alt="" src="http://toumorokoshi.github.io/images/conky-dropbox-demo.png" />
<p>This is a pretty generic approach on adding anything into conky +
dzen. Here's the steps I took:</p>
<div class="section" id="write-some-scripts-to-produce-the-text-you-want">
<h2>1. Write some scripts to produce the text you want</h2>
<p>Conky has methods to run arbitrary scripts and echo their
output. This abstraction makes it easy to get the text you want.</p>
<p>I started writing a couple shell scripts that get me the info I need:</p>
<pre class="literal-block">
Note: I used the Dropbox command line tool to get this info. You'll
need that installed. on arch, it's the 'dropbox-cli' package.
</pre>
<div class="highlight"><pre><span class="c"># drobox-down</span>
<span class="c"># echos the Dropbox download speed</span>
<span class="c">#!/usr/bin/env bash</span>

<span class="nv">status</span><span class="o">=</span><span class="sb">`</span>dropbox status | grep Downloading<span class="sb">`</span>
<span class="nv">SYNC_REGEX</span><span class="o">=</span><span class="s2">&quot;([0-9,]+) KB/sec&quot;</span>

<span class="o">[[</span> <span class="nv">$status</span> <span class="o">=</span>~ <span class="nv">$SYNC_REGEX</span> <span class="o">]]</span>
<span class="nv">download_speed</span><span class="o">=</span><span class="s2">&quot;${BASH_REMATCH[1]}&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$download_speed</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;$download_speed KB/sec&quot;</span>
<span class="k">fi</span>
</pre></div>
<div class="highlight"><pre><span class="c"># drobox-up</span>
<span class="c"># echos the Dropbox upload speed</span>
<span class="c">#!/usr/bin/env bash</span>

<span class="nv">status</span><span class="o">=</span><span class="sb">`</span>dropbox status | grep Uploading<span class="sb">`</span>
<span class="nv">SYNC_REGEX</span><span class="o">=</span><span class="s2">&quot;([0-9,]+) KB/sec&quot;</span>

<span class="o">[[</span> <span class="nv">$status</span> <span class="o">=</span>~ <span class="nv">$SYNC_REGEX</span> <span class="o">]]</span>
<span class="nv">upload_speed</span><span class="o">=</span><span class="s2">&quot;${BASH_REMATCH[1]}&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$upload_speed</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;$upload_speed KB/sec&quot;</span>
<span class="k">fi</span>
</pre></div>
<div class="highlight"><pre><span class="c">#!/usr/bin/env bash</span>
<span class="c"># Dropbox-files</span>
<span class="c"># lists a single filename if only a single file is being synced</span>
<span class="c"># otherwise, echos the number of files synced</span>

<span class="nv">status</span><span class="o">=</span><span class="sb">`</span>dropbox status | grep Syncing<span class="sb">`</span>
<span class="nv">SYNC_REGEX</span><span class="o">=</span><span class="s2">&quot;([0-9,]+) files remaining&quot;</span>
<span class="nv">FILENAME_REGEX</span><span class="o">=</span><span class="s1">&#39;&quot;(.*)&quot;&#39;</span>

<span class="o">[[</span> <span class="nv">$status</span> <span class="o">=</span>~ <span class="nv">$SYNC_REGEX</span> <span class="o">]]</span>
<span class="nv">files_remaining</span><span class="o">=</span><span class="s2">&quot;${BASH_REMATCH[1]}&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$files_remaining</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span>; <span class="k">then</span>

    <span class="o">[[</span> <span class="nv">$status</span> <span class="o">=</span>~ <span class="nv">$FILENAME_REGEX</span> <span class="o">]]</span>
    <span class="nv">filename</span><span class="o">=</span><span class="s2">&quot;${BASH_REMATCH[1]}&quot;</span>
    <span class="nb">echo</span> <span class="nv">$filename</span>

<span class="k">else</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;$files_remaining files&quot;</span>
<span class="k">fi</span>
</pre></div>
</div>
<div class="section" id="create-your-own-xbm-logo">
<h2>2. Create your own xbm logo</h2>
<p>Now to get that cool Dropbox icon in there. The thing to note about
conky + dzen specifically is that you can't pipe images into your bar
(as far as I know, someone please correct me here). You're left with the
options of xbm files, which are bitmap descriptions.</p>
<p>Luckily, it's not too hard to generate your own. Gimp, the Photoshop of Linux,
can save into xbm files for you. Simply open it up, export it, and you're done!</p>
<pre class="literal-block">
Note: make sure to export the xbm to fit the size of your bar. I
couldn't find a way of telling conky to scale the image (which makes
sense, conky is just piping output dzen so it has no way of knowing
the height). My bar is about 16 pixels high, so I exported 16
pixels.
</pre>
<p>You can also download the xbm I created if you'd like: <a class="reference external" href="https://github.com/toumorokoshi/yt.rc/blob/master/xmonad/icons/Dropbox.xbm">my Dropbox xbm</a></p>
</div>
<div class="section" id="add-them-to-your-conky-script">
<h2>3. Add them to your conky script</h2>
<p>Now that we have our shell scripts, and our icons, you can execute them in your conky
script. I got the arrows from the <a class="reference external" href="http://awesome.naquadah.org/wiki/Nice_Icons">nice icon set</a>.
If you're lazy you can also get them from <a class="reference external" href="https://github.com/toumorokoshi/yt.rc">my rc files</a>.</p>
<p>Once you have all your assets, add in the relevant pieces into your conky:</p>
<div class="highlight"><pre>out_to_console yes
out_to_x no
update_interval 1

lua_load <span class="nv">$HOME</span>/.xmonad/conky_scripts/conky_lua_scripts.lua

<span class="c"># note: Dropbox needed dropbox-cli on arch</span>

TEXT
<span class="c"># ---- START DROPBOX STUFF ---</span>
^fg<span class="o">(</span><span class="se">\#</span>007ee5<span class="o">)</span> ^i<span class="o">(</span><span class="nv">$HOME</span>/.xmonad/icons/Dropbox.xbm<span class="o">)</span> <span class="se">\</span>
<span class="c"># ---- description of files changing ---</span>
^fg<span class="o">(</span><span class="se">\#</span>FFFF00<span class="o">)</span> <span class="k">${</span><span class="nv">execi</span><span class="p"> 6 </span><span class="nv">$HOME</span><span class="p">/.xmonad/conky_scripts/Dropbox-files</span><span class="k">}</span> ^fg<span class="o">()</span><span class="se">\</span>
<span class="c"># ---- download speed info ---</span>
^fg<span class="o">(</span><span class="se">\#</span>8888FF<span class="o">)</span> ^i<span class="o">(</span><span class="nv">$HOME</span>/.xmonad/icons/net_down_03.xbm<span class="o">)</span> <span class="k">${</span><span class="nv">execi</span><span class="p"> 6 </span><span class="nv">$HOME</span><span class="p">/.xmonad/conky_scripts/Dropbox-down</span><span class="k">}</span> ^fg<span class="o">()</span> / <span class="se">\</span>
<span class="c"># ---- upload speed info ---</span>
^fg<span class="o">(</span><span class="se">\#</span>AA0000<span class="o">)</span> ^i<span class="o">(</span><span class="nv">$HOME</span>/.xmonad/icons/net_up_03.xbm<span class="o">)</span> <span class="k">${</span><span class="nv">execi</span><span class="p"> 6 </span><span class="nv">$HOME</span><span class="p">/.xmonad/conky_scripts/Dropbox-up</span><span class="k">}</span> ^fg<span class="o">()</span> <span class="se">\</span>
</pre></div>
<p>Notes:</p>
<ul class="simple">
<li>I changed the colors with ^fg(#COLOR_HASH)</li>
<li>to split your conky on multiple lines, I use the delimiter '\'</li>
</ul>
<p>And there you go! You have a nice, clean Dropbox activity bar.</p>
</div>
