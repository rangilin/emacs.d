<p>
So you've just written a new macro for your Clojure DSL, and now you
have something like:
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #f92672;">defwidget</span> <span style="color: #a6e22e;">my-widget</span>
  ...)
</pre>
</div>

<p>
And you'd love to add syntax highlighting to Emacs so that it gets
highlighted the way defn and defmacro do. Here are the magic words:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">  <span style="color: #e6db74;">;;; </span><span style="color: #e6db74;">Adds new defn-esque keyword highlighting.</span>
(add-hook 'clojure-mode-hook
          '(<span style="color: #f92672;">lambda</span> ()
             (font-lock-add-keywords
                nil
                '((<span style="color: #e6db74;">"(</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">(</span><span style="color: #e6db74;">defwidget</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">)</span><span style="color: #e6db74;">\\s-+</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">(</span><span style="color: #e6db74;">\\w+</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">)</span><span style="color: #e6db74;">"</span>
                   (1 font-lock-keyword-face)
                   (2 font-lock-function-name-face))))))
</pre>
</div>

<p>
What's going on here? Well, let's break it down:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #e6db74;">;;; </span><span style="color: #e6db74;">Add a function that runs for any Clojure buffer.</span>
(add-hook 'clojure-mode-hook
  <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">An anonymous function that takes no arguments.</span>
  '(<span style="color: #f92672;">lambda</span> ()

    <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">Set some new syntax-highlighting rules.</span>
    (font-lock-add-keywords nil

      <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">So many escape codes! But we're really just saying:</span>
      <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">Match the '(' character.</span>
      <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">Match and group the string 'defwidget'.</span>
      <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">Match some whitespace. \\s-+</span>
      <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">Match and group some word characters. \\w+</span>
      '((<span style="color: #e6db74;">"(</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">(</span><span style="color: #e6db74;">defwidget</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">)</span><span style="color: #e6db74;">\\s-+</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">(</span><span style="color: #e6db74;">\\w+</span><span style="color: #e6db74; font-weight: bold;">\\</span><span style="color: #e6db74; font-weight: bold;">)</span><span style="color: #e6db74;">"</span>

            <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">The first regexp group is a keyword.</span>
            (1 font-lock-keyword-face)

            <span style="color: #e6db74;">;; </span><span style="color: #e6db74;">The second regexp group is a name.</span>
            (2 font-lock-function-name-face)

      ))))) <span style="color: #e6db74;">; </span><span style="color: #e6db74;">Close up the patient.</span>
</pre>
</div><img src="http://feeds.feedburner.com/~r/KrisJenkinsBlog/~4/EULIAJS3QLk" height="1" width="1"/>