<p>
Leiningen makes it really easy to test your project against multiple
versions of Clojure. Really staggeringly easy. Like, "I don't know a
single other language where this is so seamless," easy. It's a little
trick I picked up from <a href="http://clojure.github.io/java.jdbc/">clojure.java.jdbc</a>, and I make good use of it in
<a href="https://github.com/krisajenkins/yesql">Yesql</a>. Here's how it goes:
</p>

<p>
Since version 2, Leiningen lets you specify multiple profiles, with
their own dependency lists. What's interesting is that Clojure itself
can be one of those dependencies, so we can meaningfully add this to
<code>project.clj</code>:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #AE81FF;">:profiles</span> {<span style="color: #AE81FF;">:1.4</span> {<span style="color: #AE81FF;">:dependencies</span> [[org.clojure/clojure <span style="color: #E6DB74;">"1.4.0"</span>]]}
           <span style="color: #AE81FF;">:1.5</span> {<span style="color: #AE81FF;">:dependencies</span> [[org.clojure/clojure <span style="color: #E6DB74;">"1.5.1"</span>]]}
           <span style="color: #AE81FF;">:1.6</span> {<span style="color: #AE81FF;">:dependencies</span> [[org.clojure/clojure <span style="color: #E6DB74;">"1.6.0-beta1"</span>]]}}
</pre>
</div>

<p>
Now calling <code>lein with-profile +1.4 test</code> means "run <code>lein test</code> under
default profile <code>dev</code>, <b>plus</b> merge in the <code>1.4</code> profile". Upshot: the
code runs as normal, but under Clojure 1.4.
</p>

<p>
Now just add this alias:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #AE81FF;">:aliases</span> {<span style="color: #E6DB74;">"test-all"</span> [<span style="color: #E6DB74;">"with-profile"</span> <span style="color: #E6DB74;">"+1.4:+1.5:+1.6"</span> <span style="color: #E6DB74;">"test"</span>]}
</pre>
</div>

<p>
&#x2026;and <code>lein test-all</code> will run the test suite three times, under each
of Clojure 1.4, 1.5 and 1.6, automatically.
</p>

<p>
You can use that same trick for any dependency variations you like -
so you could check against different versions of your database driver,
for instance - but it's this 4-line use case that really made my jaw
drop.
</p><img src="http://feeds.feedburner.com/~r/KrisJenkinsBlog/~4/-TOU5bDSep0" height="1" width="1"/>