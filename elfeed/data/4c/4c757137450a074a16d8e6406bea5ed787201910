
<p>Another fun hack, translate Japanese IRC to English via Google
translate. As you can see the translation is not very good. This works
with Emacs ERC.</p>

<p class="image"><img src="erc-translate.png" alt=""></p>

<p>And here is the code:</p>

<pre class="src">
(<span style="color: #8b008b; background-color: #b9babd;">defun</span> <span style="color: #00008b; background-color: #b9babd;">ivan-erc-translate</span> ()
  <span style="color: #008b00; background-color: #b9babd;">"Display tranlation when receiving a message in Japanese"</span>
  (<span style="color: #8b008b; background-color: #b9babd;">let</span> ((string (buffer-substring-no-properties
                 (point-min) (1- (point-max)))))
    (<span style="color: #8b008b; background-color: #b9babd;">when</span> (and (ivan-erc-match-language 'japanese)
               (memq 'unicode (find-charset-region
                               (point-min) (point-max)))
               (ivan-japanese-kanji string))
      (goto-char (point-max))
      (forward-char -1)
      (insert (concat <span style="color: #8b5a00; background-color: #b9babd;">"\n"</span> (ivan-japanese-kakasi string)))
      (<span style="color: #8b008b; background-color: #b9babd;">when</span> (string-match <span style="color: #8b5a00; background-color: #b9babd;">"^\\(&lt;.*&gt; \\)\\(.*\\)"</span> string)
        (<span style="color: #8b008b; background-color: #b9babd;">let</span> ((nick (match-string 1 string))
              (message (match-string 2 string)))
          (url-retrieve
           (concat <span style="color: #8b5a00; background-color: #b9babd;">"http://translate.google.com/translate_t?text="</span>
                   (url-hexify-string message)
                   <span style="color: #8b5a00; background-color: #b9babd;">"&amp;langpair=ja|en&amp;ie=utf8&amp;oe=utf8"</span>)
           'ivan-erc-translate-callback
           (list (current-buffer) nick)))))))

(<span style="color: #8b008b; background-color: #b9babd;">defun</span> <span style="color: #00008b; background-color: #b9babd;">ivan-erc-translate-callback</span> (status buffer nick)
  (set-buffer-multibyte t)
  (goto-char (point-min))
  (<span style="color: #8b008b; background-color: #b9babd;">when</span> (search-forward <span style="color: #8b5a00; background-color: #b9babd;">"fff'\"&gt;"</span> nil t)
    (<span style="color: #8b008b; background-color: #b9babd;">let</span> ((start (point))
          (end-tag <span style="color: #8b5a00; background-color: #b9babd;">"&lt;/span&gt;"</span>)
          (url-show-status nil))
      (<span style="color: #8b008b; background-color: #b9babd;">when</span> (search-forward end-tag nil t)
        (<span style="color: #8b008b; background-color: #b9babd;">let</span> ((string (ivan-erc-remove-url-entities
                       (buffer-substring-no-properties
                        start (- (point) (length end-tag))))))
          <span style="color: #008b00; background-color: #b9babd;">;; </span><span style="color: #008b00; background-color: #b9babd;">avoid recursion
</span>          (<span style="color: #8b008b; background-color: #b9babd;">when</span> (not (ivan-japanese-kanji string))
            (erc-display-line (concat nick string) buffer))))))
  (kill-buffer))

(add-hook 'erc-insert-modify-hook 'ivan-erc-translate)
</pre>

